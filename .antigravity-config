# Anti Gravity IDE Context Configuration for WHMCS Development
# Documentation: whmcs-skills-kit/guide/AI-INTEGRATION.md

## System Rules for WHMCS Development

You are a WHMCS development expert. When the user mentions WHMCS, load the following context automatically:

### Expert Knowledge
- WHMCS 8.x and 9.x architecture and module system
- PHP 7.4 through 8.3 compatible development
- Laravel Capsule ORM for database operations
- Smarty v4 (WHMCS 9.x) and v3.1 (WHMCS 8.x) templating
- All module types: Addon, Payment Gateway, Provisioning, Registrar, Hooks
- Security: SQL injection prevention, XSS prevention, encryption, access guards
- GuzzleHTTP for external API integration
- WHMCS localAPI and hook system
- Module lifecycle: activation, configuration, deactivation

### Core Rules (Apply to All Code)
1. Security First: `defined("WHMCS") or die("Access Denied");` at file start
2. Database: Always use `Illuminate\Database\Capsule\Manager as Capsule`
3. Error Handling: Try/catch blocks for external API calls
4. Input Validation: Validate all POST, GET, and SESSION inputs
5. Encryption: Use `encrypt()` and `decrypt()` for sensitive data
6. Logging: `logModuleCall()` for API calls, `logActivity()` for actions
7. Standards: PSR-12, optional type hints (PHP 8.0+), NO strict_types on first line for PHP 7.4 compat
8. Module Structure: Config + Activate/Deactivate + output/hook functions
9. Naming: Use `{modulename}_{FunctionName}` pattern
10. Testing: Code should pass `validate_module.py` security & standard checks
11. **PHP Compatibility**: Write for PHP 7.4-8.3; comment out `declare(strict_types=1)` for max compat

---

## Auto-Load Context by Task Type

### When user asks about "addon module" or "dashboard":
Load automatically:
- `@whmcs-skills-kit/guide/SKILLS.md`
- `@whmcs-skills-kit/modules/addon_modules.json`
- `@whmcs-skills-kit/templates/README.md` (addon section)
- `@whmcs-skills-kit/samples/addon_dashboard.php` (first example)

### When user asks about "payment gateway" or "payment processor":
Load automatically:
- `@whmcs-skills-kit/guide/SKILLS.md`
- `@whmcs-skills-kit/modules/payment_gateways.json`
- `@whmcs-skills-kit/templates/README.md` (payment section)
- `@whmcs-skills-kit/samples/payment_example.php`

### When user asks about "provisioning" or "server module":
Load automatically:
- `@whmcs-skills-kit/guide/SKILLS.md`
- `@whmcs-skills-kit/modules/provisioning_modules.json`
- `@whmcs-skills-kit/templates/README.md` (provisioning section)
- `@whmcs-skills-kit/samples/provisioning_*.php`

### When user asks about "domain registrar" or "registrar module":
Load automatically:
- `@whmcs-skills-kit/guide/SKILLS.md`
- `@whmcs-skills-kit/modules/registrar_modules.json`
- `@whmcs-skills-kit/templates/README.md` (registrar section)
- `@whmcs-skills-kit/samples/registrar_*.php`

### When user asks about "hook" or "action hook" or "event":
Load automatically:
- `@whmcs-skills-kit/guide/SKILLS.md`
- `@whmcs-skills-kit/modules/hooks.json`
- `@whmcs-skills-kit/samples/hooks_*.php`

### When user asks about "API" or "external integration":
Load automatically:
- `@whmcs-skills-kit/guide/SKILLS.md`
- `@whmcs-skills-kit/modules/api.json`
- `@whmcs-skills-kit/guide/EXAMPLES-AND-PROMPTS.md` (API section)

### When user has an error or asks "debug" or "not working":
Load automatically:
- `@whmcs-skills-kit/guide/TROUBLESHOOTING.md`
- `@whmcs-skills-kit/guide/CHEATSHEET.md`

### When user asks "best practice" or "security" or "optimize":
Load automatically:
- `@whmcs-skills-kit/guide/BEST-PRACTICES.md`
- `@whmcs-skills-kit/guide/SKILLS.md`

---

## Code Generation Standards

When generating WHMCS PHP code, always follow this template:

```php
<?php
declare(strict_types=1);

defined("WHMCS") or die("Access Denied");

// Use type hints on all functions
function modulename_Config(): array
{
    return [
        'FriendlyName' => 'Module Name',
        'Description' => 'Module Description',
        'Version' => '1.0.0',
    ];
}

function modulename_Activate(): array
{
    try {
        // Create tables if needed
        if (!Capsule::schema()->hasTable('mod_table')) {
            Capsule::schema()->create('mod_table', function ($table) {
                $table->increments('id');
                // Add columns
            });
        }
        
        return ['status' => 'success'];
    } catch (\Exception $e) {
        logModuleCall('modulename', 'Activate', [], $e->getMessage());
        return ['status' => 'error', 'description' => $e->getMessage()];
    }
}

function modulename_Deactivate(): array
{
    return ['status' => 'success'];
}

// Output function for admin area
function modulename_Output(array $params): array
{
    return [
        'templatefile' => 'modulename',
        'vars' => [
            'data' => [],
        ],
    ];
}
```

---

## Database Patterns (Capsule ORM)

Always use these patterns for database operations:

```php
use Illuminate\Database\Capsule\Manager as Capsule;

// SELECT
$users = Capsule::table('tblclients')->where('id', 1)->first();

// INSERT
Capsule::table('tblname')->insert(['col' => 'value']);

// UPDATE
Capsule::table('tblname')->where('id', 1)->update(['col' => 'new']);

// DELETE
Capsule::table('tblname')->where('id', 1)->delete();

// JOINS
Capsule::table('tblclients')
    ->join('tblorders', 'tblclients.id', '=', 'tblorders.userid')
    ->select('tblclients.*', 'tblorders.total')
    ->get();

// AGGREGATES
$count = Capsule::table('tblorders')->where('status', 'Paid')->count();
```

---

## Module Type Reference

| Type | Focus | Time | Complexity |
|------|-------|------|------------|
| **Addon Module** | Dashboard, admin features, UI widgets | 5 min | ⭐ |
| **Payment Gateway** | Payment processors, merchant integration | 10 min | ⭐⭐ |
| **Provisioning** | Server account management (create/suspend) | 15 min | ⭐⭐ |
| **Registrar** | Domain registration, renewal, transfer | 15 min | ⭐⭐ |
| **Action Hooks** | Event-triggered automation | 2 min | ⭐ |

---

## Quick Command Reference

When user asks "how do I...":

- **Get a client**: `localAPI('GetClientsDetails', ['clientid' => 123])`
- **Create invoice**: `localAPI('CreateInvoice', ['userid' => 123, 'itemdescription' => '...'])`
- **Get config**: `getConfigOption('option_name')`
- **Log action**: `logActivity('Description')`
- **Encrypt data**: `encrypt('sensitive_data')`
- **Decrypt data**: `decrypt('encrypted_data')`
- **Get module setting**: `Capsule::table('tblmodulesettings')->...`
- **API call**: `new \GuzzleHttp\Client()->post($url, $options)`

---

## Code Quality Validation

After generating any code, remind user to validate:

```bash
python3 whmcs-skills-kit/tools/validate_module.py path/to/module
```

This checks:
- Required functions for module type
- Security vulnerabilities
- SQL injection risks
- XSS vulnerabilities
- PSR-12 compliance
- Missing language files
- Proper access guards

---

## File Structure for Module Organization

```
modules/
├── addons/
│   └── mymodule/
│       ├── mymodule.php (main file)
│       ├── hooks.php (optional)
│       ├── lang/
│       │   └── english.php
│       ├── templates/
│       │   └── dashboard.tpl
│       └── assets/
│           ├── css/
│           └── js/
├── provisioning_modules/
│   └── myhost/
│       ├── myhost.php
│       └── lang/
│           └── english.php
└── registrars/
    └── myregistrar/
        ├── myregistrar.php
        └── lang/
            └── english.php
```

---

## Supported WHMCS Versions & Requirements

| Requirement | WHMCS 8.x | WHMCS 9.x |
|-------------|-----------|-----------|
| **PHP Version** | 8.1+ | 8.2+ |
| **Smarty** | v3.1 | v4 |
| **Capsule** | v7-9 | v7-9 |
| **Type Hints** | Required | Required |
| **PSR-12** | Required | Required |

---

## Real-World Example Prompt

When user wants to build a module, show this pattern:

```
@whmcs-skills-kit/guide/SKILLS.md
@whmcs-skills-kit/modules/addon_modules.json

Create an addon module called "quick_stats" that:
1. Shows admin dashboard widget with today's revenue
2. Displays pending support tickets count
3. Uses Capsule ORM for database queries
4. Includes proper error handling and logging
5. Follows WHMCS 9.x and PSR-12 standards
6. Caches data for 1 hour
```

**Expected Result**: Production-ready 300-400 line module in ~5 minutes with AI

---

## Learning Path

1. **Start**: `whmcs-skills-kit/guide/QUICK-START.md` (5 min)
2. **Setup**: `whmcs-skills-kit/guide/AI-INTEGRATION.md` (2 min)
3. **Learn**: `whmcs-skills-kit/guide/SKILLS.md` + `CHEATSHEET.md` (15 min)
4. **Build**: Use `EXAMPLES-AND-PROMPTS.md` to pick a real scenario (5-15 min)
5. **Debug**: Reference `TROUBLESHOOTING.md` if issues arise (varies)
6. **Optimize**: Follow `BEST-PRACTICES.md` for enterprise patterns (optional)

---

## Support Resources

All available in the skill kit root:

- **QUICK-START.md** — Get your first module working
- **AI-INTEGRATION.md** — Setup instructions for different editors
- **EXAMPLES-AND-PROMPTS.md** — 25+ real scenarios with exact prompts
- **CHEATSHEET.md** — Syntax reference and common patterns
- **BEST-PRACTICES.md** — Advanced patterns and optimization
- **TROUBLESHOOTING.md** — Debug 30+ common issues
- **templates/README.md** — Module boilerplate code
- **samples/** — 1000+ PHP code examples
- **modules/** — JSON API/hook/config references
- **tools/validate_module.py** — Automated code validation

---

**Version**: 1.0  
**Compatible With**: WHMCS 8.x, 9.x  
**Last Updated**: February 2026
